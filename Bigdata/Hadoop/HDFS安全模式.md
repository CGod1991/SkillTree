# HDFS 安全模式

标签：HDFS safemode

---

简单介绍下 HDFS 的安全模式。

当 NameNode 节点启动时，在最开始的时候，NameNode 节点的内存中是空白的。此时，NameNode 需要经过两个阶段才能完成整个 HDFS 文件系统的启动。

## 进入安全模式

在 NameNode 启动或重启的过程中，首先会进入安全模式。

将文件系统的元数据镜像文件（也就是 FSImage 文件）加载到内存中，然后执行 EditLog 文件。该过程结束后，会创建一个新的检查点，也就是会生成一个新的元数据镜像文件和一个空白的 EditLog文件。之后，NameNode 节点开始监听 IPC 和 HTTP 端口，对外提供服务。但需要注意的时，此时 NameNode 提供的是一个只读的视图，也就是说，这个时候进入了安全模式。

## 离开安全模式

进入安全模式后，NameNode 节点需要获取到整个文件系统中所有数据块的信息，换言之，需要等待所有的数据节点上报各自节点上的数据块分布情况。当 NameNode 获取到足够多的数据块信息后，才能离开安全模式，对外提供完整的读写服务。

那么如何判断 NameNode 是否获取到了足够多的数据块信息了呢？

主要由以下几个参数做控制。

### dfs.replication.min

该配置项定义了每个数据块的最小副本数。

当向 HDFS 中上传或写入数据时，只有数据块的副本数大于该配置项的值，才认为写入成功。

### dfs.safemode.threshold.pct

该配置项表示当系统离开安全模式时，满足最小副本数的副本的百分比。

该值小于等于 0 表示立即退出安全模式，大于 1 则表示永远处于安全模式。默认值为 0.95 。

### dfs.namenode.safemode.extension

该配置型表示在满足了 `dfs.safemode.threshold.pct` 配置项的条件之后，还需要处于安全模式的时间，单位为妙。默认值为 0 。

